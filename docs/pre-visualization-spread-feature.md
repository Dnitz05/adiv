# Informe TÃ¨cnic: PÃ gina de Pre-visualitzaciÃ³ de Tirades

## 1. VisiÃ³ General

### Concepte
Una nova funcionalitat que transforma l'experiÃ¨ncia de tirada de tarot en un procÃ©s educatiu, immersiu i progressiu en 4 fases:

1. **SelecciÃ³ IntelÂ·ligent**: La IA analitza la pregunta i tria la tirada mÃ©s adequada
2. **Pre-visualitzaciÃ³ DidÃ ctica**: Es mostra el layout buit amb explicacions de cada posiciÃ³
3. **Tirada Progressiva**: Les cartes apareixen d'esquena ocupant les posicions
4. **RevelaciÃ³ Interactiva**: L'usuari gira cada carta individualment

### Beneficis
- **Educatiu**: L'usuari aprÃ¨n sobre les diferents tirades i significats
- **Personalitzat**: Cada pregunta obtÃ© la tirada mÃ©s adequada
- **Immersiu**: El procÃ©s gradual crea anticipaciÃ³ i misteri
- **Professional**: Replica l'experiÃ¨ncia d'una lectura real de tarot
- **Memorable**: L'experiÃ¨ncia interactiva fa que cada lectura sigui especial

---

## 2. Flux d'Usuari Detallat

### Fase 1: Entrada de pregunta
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Quin Ã©s el teu dubte?              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ [Pregunta de l'usuari]        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚           [CONSULTAR]                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Fase 2: AnÃ lisi IA i Pre-visualitzaciÃ³
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ¨ Tirada recomanada: CRUZ CELTA                â”‚
â”‚                                                  â”‚
â”‚ "He escollit la Cruz Celta perquÃ¨ la teva       â”‚
â”‚  pregunta tracta sobre una situaciÃ³ complexa    â”‚
â”‚  que requereix entendre mÃºltiples factors."     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          VISUALITZACIÃ“ DE LA TIRADA              â”‚
â”‚                                                  â”‚
â”‚         [2]    [1]    [3]                        â”‚
â”‚                [5]                               â”‚
â”‚         [4]    [6]    [7]                        â”‚
â”‚                        [8]                       â”‚
â”‚                        [9]                       â”‚
â”‚                       [10]                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SIGNIFICAT DE LES POSICIONS:                   â”‚
â”‚                                                  â”‚
â”‚  1ï¸âƒ£ SituaciÃ³ actual - El present                â”‚
â”‚  2ï¸âƒ£ Desafiament - Obstacles immediats           â”‚
â”‚  3ï¸âƒ£ Base - Fonament de la situaciÃ³             â”‚
â”‚  4ï¸âƒ£ Passat recent - InfluÃ¨ncies passades       â”‚
â”‚  5ï¸âƒ£ Possibilitats - Millor resultat possible   â”‚
â”‚  6ï¸âƒ£ Futur proper - Propers esdeveniments       â”‚
â”‚  7ï¸âƒ£ Tu mateix - La teva posiciÃ³                â”‚
â”‚  8ï¸âƒ£ Entorn - InfluÃ¨ncies externes              â”‚
â”‚  9ï¸âƒ£ Esperances/Temors - Emocions internes      â”‚
â”‚  ğŸ”Ÿ Resultat final - DesenllaÃ§ probable         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

          [COMENÃ‡AR TIRADA] ğŸ´
```

### Fase 3: Tirada progressiva (cartes d'esquena)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Tirant les cartes...                        â”‚
â”‚                                                  â”‚
â”‚      [ğŸ‚ ]   [ğŸ‚ ]   [ğŸ‚ ]                          â”‚
â”‚             [ğŸ‚ ]                                 â”‚
â”‚      [ğŸ‚ ]   [ğŸ‚ ]   [ğŸ‚ ]                          â”‚
â”‚                    [ğŸ‚ ]                          â”‚
â”‚                    [ğŸ‚ ]                          â”‚
â”‚                    [ğŸ‚ ]                          â”‚
â”‚                                                  â”‚
â”‚  âœ¨ AnimaciÃ³: cada carta apareix amb efecte     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

      [REVELAR CARTES] ğŸ”®
```

### Fase 4: RevelaciÃ³ interactiva
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Clica cada carta per revelar-la                â”‚
â”‚                                                  â”‚
â”‚    [ğŸ‚ ]  [The Fool]  [ğŸ‚ ]                        â”‚
â”‚          [ğŸ‚ ]                                    â”‚
â”‚    [Death]  [ğŸ‚ ]  [Lovers]                       â”‚
â”‚                   [ğŸ‚ ]                           â”‚
â”‚                   [ğŸ‚ ]                           â”‚
â”‚                   [ğŸ‚ ]                           â”‚
â”‚                                                  â”‚
â”‚  ğŸ’¡ 3/10 cartes revelades                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Quan totes les cartes estiguin revelades:
      [INTERPRETAR TIRADA] ğŸŒŸ
```

---

## 3. Arquitectura TÃ¨cnica

### 3.1 Components Frontend (Flutter)

#### Nous arxius necessaris:
```
lib/
â”œâ”€â”€ screens/
â”‚   â”œâ”€â”€ spread_preview_screen.dart     # Pantalla principal
â”‚   â””â”€â”€ spread_reveal_screen.dart      # Pantalla de revelaciÃ³
â”œâ”€â”€ widgets/
â”‚   â”œâ”€â”€ spread_selector_card.dart      # Card explicativa IA
â”‚   â”œâ”€â”€ spread_layout_widget.dart      # Layout de posicions
â”‚   â”œâ”€â”€ position_placeholder.dart      # Espai buit numerat
â”‚   â”œâ”€â”€ card_back_widget.dart          # Carta d'esquena
â”‚   â”œâ”€â”€ flippable_card_widget.dart     # Carta que es pot girar
â”‚   â””â”€â”€ position_legend_widget.dart    # Llegenda de posicions
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ spread_definition.dart         # DefiniciÃ³ de tirada
â”‚   â”œâ”€â”€ spread_position.dart           # PosiciÃ³ dins tirada
â”‚   â””â”€â”€ spread_recommendation.dart     # Resposta de la IA
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ spread_selector_service.dart   # LÃ²gica selecciÃ³ tirada
â”‚   â””â”€â”€ card_animation_service.dart    # Animacions
â””â”€â”€ state/
    â””â”€â”€ spread_state.dart              # GestiÃ³ d'estat (Riverpod)
```

#### Estats de la pantalla:
```dart
enum SpreadScreenState {
  showingRecommendation,  // Fase 2: Pre-visualitzaciÃ³
  dealing,                // Fase 3: Tirant cartes
  waitingForReveal,       // Fase 4: Cartes d'esquena
  revealing,              // Fase 4: Girant cartes
  allRevealed,            // Totes revelades
  interpreting            // Interpretant
}
```

### 3.2 Models de Dades

```dart
// spread_definition.dart
class SpreadDefinition {
  final String id;
  final String name;
  final String nameCA;
  final String description;
  final int cardCount;
  final List<SpreadPosition> positions;
  final SpreadCategory category;
  final SpreadComplexity complexity;
  final List<String> suitableFor; // ["love", "career", "decision"]

  // Layout information
  final double layoutWidth;
  final double layoutHeight;
}

class SpreadPosition {
  final int number;
  final String meaning;
  final String meaningCA;
  final Offset coordinates; // PosiciÃ³ X,Y en el layout
  final double rotation;    // RotaciÃ³ de la carta (0, 90, 180, 270)
}

enum SpreadCategory {
  general,
  love,
  career,
  decision,
  spiritual,
  monthly,
  yearly
}

enum SpreadComplexity {
  simple,      // 1-3 cartes
  medium,      // 4-7 cartes
  complex,     // 8-10 cartes
  extended     // 11+ cartes
}

// spread_recommendation.dart
class SpreadRecommendation {
  final SpreadDefinition spread;
  final String reasoning;
  final double confidenceScore; // 0-1
  final List<String> keyFactors; // Factors detectats en la pregunta
}
```

### 3.3 Backend (Next.js API)

#### Nou endpoint:
```typescript
// pages/api/spread/recommend.ts

export default async function handler(
  req: NextApiRequest,
  res: NextApiResponse
) {
  const { question, locale } = req.body;

  // 1. Analitzar pregunta amb IA
  const analysis = await analyzeQuestion(question);

  // 2. Seleccionar tirada mÃ©s adequada
  const spread = selectBestSpread(analysis);

  // 3. Generar explicaciÃ³ personalitzada
  const reasoning = await generateReasoning(question, spread, locale);

  return res.json({
    spread: spread,
    reasoning: reasoning,
    analysis: {
      category: analysis.category,
      complexity: analysis.complexity,
      keywords: analysis.keywords
    }
  });
}
```

#### Sistema de selecciÃ³ de tirades:
```typescript
interface QuestionAnalysis {
  category: string;        // "love", "career", "decision", etc.
  complexity: string;      // "simple", "medium", "complex"
  keywords: string[];      // Paraules clau detectades
  tone: string;           // "anxious", "hopeful", "confused"
  specificity: number;    // 0-1, quan especÃ­fica Ã©s
}

function selectBestSpread(analysis: QuestionAnalysis): SpreadDefinition {
  let candidates: SpreadDefinition[] = [];

  // Filtrar per categoria
  if (analysis.category === "love") {
    candidates = SPREADS.filter(s => s.suitableFor.includes("love"));
  } else if (analysis.category === "decision") {
    candidates = SPREADS.filter(s => s.suitableFor.includes("decision"));
  }

  // Filtrar per complexitat
  candidates = candidates.filter(s => {
    if (analysis.complexity === "simple") return s.cardCount <= 3;
    if (analysis.complexity === "medium") return s.cardCount <= 7;
    return true;
  });

  // Si no hi ha candidats, usar tirada per defecte
  if (candidates.length === 0) {
    return THREE_CARD_SPREAD; // Passat-Present-Futur
  }

  // Retornar la mÃ©s adequada (podrÃ­em usar ML aquÃ­)
  return candidates[0];
}
```

---

## 4. Tirades Disponibles (Fase 1)

### 4.1 Tirada de 3 Cartes (Passat-Present-Futur)
**Adequada per**: Preguntes generals, visiÃ³ rÃ pida
```
Layout:
   [1]  [2]  [3]

Posicions:
1. Passat - InfluÃ¨ncies passades
2. Present - SituaciÃ³ actual
3. Futur - DirecciÃ³ probable
```

### 4.2 Cruz Celta (10 cartes)
**Adequada per**: Situacions complexes, anÃ lisi profunda
```
Layout:
         [2]
    [4]  [1]  [6]
         [5]
         [3]
                 [7]
                 [8]
                 [9]
                 [10]

Posicions:
1. SituaciÃ³ actual - El nucli del tema
2. Desafiament - Obstacle o influÃ¨ncia creuada
3. Base - Fonament subconscient
4. Passat recent - InfluÃ¨ncies en retirada
5. Possibilitats - Millor resultat possible
6. Futur proper - Esdeveniments propers (6 mesos)
7. Tu mateix - La teva actitud/posiciÃ³
8. Entorn - InfluÃ¨ncies externes/persones
9. Esperances i temors - Aspectes emocionals
10. Resultat final - DesenllaÃ§ mÃ©s probable
```

### 4.3 Tirada de DecisiÃ³ (7 cartes)
**Adequada per**: Triar entre dues opcions
```
Layout:
      [1]
  [2]   [3]
  [4]   [5]
  [6]   [7]

Posicions:
1. Tu/SituaciÃ³ - PosiciÃ³ actual
2. OpciÃ³ A - Pro
3. OpciÃ³ B - Pro
4. OpciÃ³ A - Contra
5. OpciÃ³ B - Contra
6. OpciÃ³ A - Resultat
7. OpciÃ³ B - Resultat
```

### 4.4 Tirada d'Amor (5 cartes)
**Adequada per**: Relacions, amor, connexions
```
Layout:
      [3]
  [1]   [2]
  [4]   [5]

Posicions:
1. Tu - La teva energia/posiciÃ³
2. L'altra persona - La seva energia
3. ConnexiÃ³ - L'energia entre vosaltres
4. Obstacles - Desafiaments de la relaciÃ³
5. Potencial - Cap on va la relaciÃ³
```

### 4.5 Tirada del CamÃ­ (5 cartes)
**Adequada per**: Desenvolupament personal, viatge vital
```
Layout:
[1] â†’ [2] â†’ [3] â†’ [4] â†’ [5]

Posicions:
1. On ets ara - SituaciÃ³ present
2. Primer pas - AcciÃ³ immediata
3. Obstacle - Repte a superar
4. Ajuda - Recursos disponibles
5. DestinaciÃ³ - On et porta el camÃ­
```

---

## 5. Animacions i UX

### 5.1 AnimaciÃ³ de tirada (Fase 3)
```dart
class CardDealAnimation extends StatefulWidget {
  final List<SpreadPosition> positions;
  final Function(int) onCardDealt;

  // SeqÃ¼Ã¨ncia:
  // 1. Carta apareix des del centre amb escala 0 â†’ 1
  // 2. Es mou a la seva posiciÃ³ (curve: Curves.easeOutCubic)
  // 3. Rota a la seva orientaciÃ³ final
  // 4. Delay de 300ms
  // 5. SegÃ¼ent carta

  Duration get delayBetweenCards => Duration(milliseconds: 400);
  Duration get cardDealDuration => Duration(milliseconds: 600);
}
```

### 5.2 AnimaciÃ³ de gir (Fase 4)
```dart
class FlippableCard extends StatefulWidget {
  final bool isRevealed;
  final TarotCard card;

  // Efecte 3D:
  // - Transform.rotateY de 0 â†’ Ï€ (180 graus)
  // - A 90 graus (Ï€/2) canviar de back â†’ front
  // - Curve: Curves.easeInOut
  // - Duration: 600ms

  void flip() {
    setState(() {
      _animationController.forward();
    });
  }
}
```

### 5.3 Feedback visual
- **Pre-visualitzaciÃ³**: NÃºmeros grans, colors suaus, borders puntejats
- **Cartes d'esquena**: Disseny elegant, possibilitat de personalitzar
- **Carta girant**: Shadow dinÃ mic, efecte de profunditat
- **Carta revelada**: Brillantor subtil, escala lleugerament mÃ©s gran

---

## 6. LÃ²gica de SelecciÃ³ de Tirades per IA

### 6.1 AnÃ lisi de pregunta amb GPT-4

```typescript
const SPREAD_SELECTION_PROMPT = `
Analitza la segÃ¼ent pregunta de tarot i determina:

1. CATEGORIA (tria una):
   - "love" - Relacions, amor, connexions personals
   - "career" - Treball, carrera, Ã¨xit professional
   - "decision" - Triar entre opcions, dilemes
   - "spiritual" - Creixement personal, propÃ²sit
   - "general" - Pregunta general o mÃºltiples aspectes

2. COMPLEXITAT (tria una):
   - "simple" - Pregunta directa, resposta sÃ­/no
   - "medium" - SituaciÃ³ amb alguns factors
   - "complex" - SituaciÃ³ multifacÃ¨tica, profunda

3. PARAULES CLAU: Llista de 3-5 paraules clau

4. TO EMOCIONAL (tria un):
   - "anxious" - Preocupat, ansiÃ³s
   - "hopeful" - EsperanÃ§at, optimista
   - "confused" - ConfÃ³s, necessita claredat
   - "curious" - CuriÃ³s, explorant
   - "urgent" - Urgent, necessita resposta rÃ pida

Pregunta: "{question}"

Respon en format JSON.
`;

async function analyzeQuestion(question: string): Promise<QuestionAnalysis> {
  const response = await openai.chat.completions.create({
    model: "gpt-4",
    messages: [
      { role: "system", content: SPREAD_SELECTION_PROMPT },
      { role: "user", content: question }
    ],
    response_format: { type: "json_object" }
  });

  return JSON.parse(response.choices[0].message.content);
}
```

### 6.2 GeneraciÃ³ de l'explicaciÃ³

```typescript
async function generateReasoning(
  question: string,
  spread: SpreadDefinition,
  locale: string
): Promise<string> {
  const prompt = `
Has recomanat la tirada "${spread.name}" per aquesta pregunta:
"${question}"

Explica en 2-3 frases curtes i clares (mÃ x 150 paraules) PER QUÃˆ aquesta
tirada Ã©s la mÃ©s adequada. Sigues especÃ­fic sobre quÃ¨ aspectes de la
pregunta es beneficiaran d'aquesta tirada.

Idioma: ${locale === 'ca' ? 'catalÃ ' : 'castellÃ '}
To: EmpÃ tic, mÃ­stic perÃ² accessible
`;

  const response = await openai.chat.completions.create({
    model: "gpt-4",
    messages: [{ role: "user", content: prompt }],
    max_tokens: 200
  });

  return response.choices[0].message.content;
}
```

### 6.3 Matriu de decisiÃ³

| Pregunta contÃ©... | Categoria | Tirada recomanada |
|-------------------|-----------|-------------------|
| "amor", "parella", "relaciÃ³" | love | Tirada d'Amor (5) |
| "decidir", "triar", "opciÃ³" | decision | Tirada de DecisiÃ³ (7) |
| "treball", "carrera", "feina" | career | Cruz Celta (10) |
| Pregunta curta (< 10 paraules) | general | 3 Cartes (simple) |
| Pregunta llarga (> 30 paraules) | general | Cruz Celta (10) |
| "futur", "que passarÃ " | general | 3 Cartes o El CamÃ­ |
| "per quÃ¨", "causa" | general | Cruz Celta (10) |

---

## 7. PersistÃ¨ncia i Historial

### 7.1 Estructura de dades guardada

```typescript
interface SavedSpreadReading {
  id: string;
  userId: string;
  timestamp: Date;

  // Fase 1: Pregunta
  question: string;

  // Fase 2: SelecciÃ³
  spreadId: string;
  spreadName: string;
  reasoning: string;

  // Fase 3-4: Cartes
  cards: {
    position: number;
    cardId: string;
    isReversed: boolean;
    revealedAt: Date;
  }[];

  // Fase 5: InterpretaciÃ³ (existent)
  interpretation?: string;

  // Metadata
  locale: string;
  completedAt?: Date;
}
```

### 7.2 Endpoints necessaris

```typescript
// Guardar pre-visualitzaciÃ³
POST /api/readings/spread/preview
Body: {
  question: string,
  spreadId: string,
  reasoning: string
}
Response: { readingId: string }

// Actualitzar amb cartes
PUT /api/readings/{readingId}/cards
Body: {
  cards: Array<{position, cardId, isReversed}>
}

// Marcar carta com a revelada
PUT /api/readings/{readingId}/reveal/{position}
Body: { revealedAt: timestamp }

// Obtenir historial amb tirades
GET /api/readings/history?includeSpread=true
```

---

## 8. ImplementaciÃ³ per Fases

### FASE 1: Core Structure (Setmana 1-2)
**Objectiu**: Estructura bÃ sica i models de dades

- [ ] Crear models Dart (SpreadDefinition, SpreadPosition, etc.)
- [ ] Definir les 5 tirades inicials (dades hardcoded)
- [ ] Crear SpreadPreviewScreen amb layout estÃ tic
- [ ] Implementar PositionPlaceholder widget
- [ ] Crear backend endpoint `/api/spread/recommend` (versiÃ³ simple)

**Deliverable**: Pantalla que mostra una tirada amb posicions buides

### FASE 2: IA Selection (Setmana 3)
**Objectiu**: SelecciÃ³ intelÂ·ligent de tirades

- [ ] Implementar anÃ lisi de preguntes amb GPT-4
- [ ] Crear matriu de decisiÃ³ per selecciÃ³
- [ ] Generar explicacions personalitzades
- [ ] Integrar amb frontend
- [ ] Testing amb diferents tipus de preguntes

**Deliverable**: Sistema que tria automÃ ticament la tirada adequada

### FASE 3: Animations (Setmana 4)
**Objectiu**: Animacions de tirada i revelaciÃ³

- [ ] Implementar animaciÃ³ de "dealing" (cartes caient)
- [ ] Crear FlippableCard widget amb rotaciÃ³ 3D
- [ ] Afegir CardBackWidget personalitzat
- [ ] Implementar gestiÃ³ d'estat per revelaciÃ³ progressiva
- [ ] Polir timing i curves d'animaciÃ³

**Deliverable**: ExperiÃ¨ncia animada completa

### FASE 4: Integration (Setmana 5)
**Objectiu**: Integrar amb flux existent

- [ ] Connectar amb pantalla de consulta actual
- [ ] Integrar amb sistema d'interpretaciÃ³ existent
- [ ] Actualitzar base de dades per guardar tirades
- [ ] Afegir al historial
- [ ] Testing end-to-end

**Deliverable**: Feature completament integrada

### FASE 5: Polish & Extras (Setmana 6)
**Objectiu**: Refinament i features extra

- [ ] Afegir sons subtils (opcional)
- [ ] Implementar haptic feedback
- [ ] Optimitzar rendiment d'animacions
- [ ] Afegir onboarding/tutorial
- [ ] Testing d'usuaris
- [ ] Fixes i millores

**Deliverable**: Feature production-ready

---

## 9. Consideracions TÃ¨cniques

### 9.1 Performance
- **Animacions**: Usar `AnimatedBuilder` i evitar `setState()` innecesaris
- **Imatges**: Precarregar cartes amb `precacheImage()`
- **Layouts**: Usar `CustomPaint` per layouts complexos
- **GestiÃ³ d'estat**: Riverpod amb providers especÃ­fics per cada fase

### 9.2 Responsivitat
```dart
class SpreadLayout {
  // Adaptar layout segons mida de pantalla
  static SpreadLayoutConfig getLayoutConfig(BuildContext context) {
    final size = MediaQuery.of(context).size;
    final isTablet = size.width > 600;

    return SpreadLayoutConfig(
      cardWidth: isTablet ? 120 : 80,
      cardHeight: isTablet ? 180 : 120,
      spacing: isTablet ? 16 : 12,
      padding: isTablet ? 24 : 16,
    );
  }
}
```

### 9.3 Accessibilitat
- **Semantics**: Afegir labels descriptius a cada posiciÃ³
- **Screen readers**: Anunciar quan carta es revela
- **Alternative input**: Permetre navegaciÃ³ per teclat (web)
- **Contrast**: Assegurar llegibilitat en posicions numerades

### 9.4 InternacionalitzaciÃ³
```dart
// l10n/spreads_ca.dart
const spreads_ca = {
  'three_card_spread': {
    'name': 'Tirada de 3 Cartes',
    'description': 'Una visiÃ³ rÃ pida del passat, present i futur',
    'positions': {
      1: 'Passat - InfluÃ¨ncies passades',
      2: 'Present - SituaciÃ³ actual',
      3: 'Futur - DirecciÃ³ probable',
    }
  },
  // ... mÃ©s tirades
};
```

---

## 10. Mockups UI/UX

### 10.1 Pre-visualitzaciÃ³ (Desktop/Tablet)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â† Tornar              CONSULTA DE TAROT                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  âœ¨ Tirada recomanada                                  â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  CRUZ CELTA (10 cartes)                               â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  He escollit aquesta tirada perquÃ¨ la teva pregunta    â”‚   â”‚
â”‚  â”‚  sobre el teu futur professional requereix una anÃ lisi â”‚   â”‚
â”‚  â”‚  profunda de mÃºltiples factors: la teva situaciÃ³       â”‚   â”‚
â”‚  â”‚  actual, obstacles, influÃ¨ncies externes i el camÃ­     â”‚   â”‚
â”‚  â”‚  mÃ©s probable. La Cruz Celta et donarÃ  una visiÃ³       â”‚   â”‚
â”‚  â”‚  completa de tots aquests aspectes.                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              DISPOSICIÃ“ DE LA TIRADA                   â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚               â”Œâ”€â”€â”€â”                                    â”‚   â”‚
â”‚  â”‚               â”‚ 2 â”‚                                    â”‚   â”‚
â”‚  â”‚               â””â”€â”€â”€â”˜                                    â”‚   â”‚
â”‚  â”‚         â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â”         â”Œâ”€â”€â”€â”              â”‚   â”‚
â”‚  â”‚         â”‚ 4 â”‚ â”‚ 1 â”‚ â”‚ 6 â”‚         â”‚ 7 â”‚              â”‚   â”‚
â”‚  â”‚         â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜ â””â”€â”€â”€â”˜         â””â”€â”€â”€â”˜              â”‚   â”‚
â”‚  â”‚               â”Œâ”€â”€â”€â”                â”Œâ”€â”€â”€â”              â”‚   â”‚
â”‚  â”‚               â”‚ 5 â”‚                â”‚ 8 â”‚              â”‚   â”‚
â”‚  â”‚               â””â”€â”€â”€â”˜                â””â”€â”€â”€â”˜              â”‚   â”‚
â”‚  â”‚               â”Œâ”€â”€â”€â”                â”Œâ”€â”€â”€â”              â”‚   â”‚
â”‚  â”‚               â”‚ 3 â”‚                â”‚ 9 â”‚              â”‚   â”‚
â”‚  â”‚               â””â”€â”€â”€â”˜                â””â”€â”€â”€â”˜              â”‚   â”‚
â”‚  â”‚                                    â”Œâ”€â”€â”€â”              â”‚   â”‚
â”‚  â”‚                                    â”‚10 â”‚              â”‚   â”‚
â”‚  â”‚                                    â””â”€â”€â”€â”˜              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  SIGNIFICAT DE LES POSICIONS                           â”‚   â”‚
â”‚  â”‚                                                         â”‚   â”‚
â”‚  â”‚  1ï¸âƒ£  SituaciÃ³ actual - El nucli del teu dubte          â”‚   â”‚
â”‚  â”‚  2ï¸âƒ£  Desafiament - Obstacle que et creua              â”‚   â”‚
â”‚  â”‚  3ï¸âƒ£  Base - Fonament subconscient de la situaciÃ³      â”‚   â”‚
â”‚  â”‚  4ï¸âƒ£  Passat recent - InfluÃ¨ncies que s'allunyen       â”‚   â”‚
â”‚  â”‚  5ï¸âƒ£  Possibilitats - El millor resultat possible      â”‚   â”‚
â”‚  â”‚  6ï¸âƒ£  Futur proper - Esdeveniments dels propers mesos  â”‚   â”‚
â”‚  â”‚  7ï¸âƒ£  Tu mateix - La teva actitud i energia            â”‚   â”‚
â”‚  â”‚  8ï¸âƒ£  Entorn - InfluÃ¨ncies externes i persones         â”‚   â”‚
â”‚  â”‚  9ï¸âƒ£  Esperances/Temors - Els teus sentiments profunds â”‚   â”‚
â”‚  â”‚  ğŸ”Ÿ Resultat final - El desenllaÃ§ mÃ©s probable         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                â”‚
â”‚                  [COMENÃ‡AR TIRADA] ğŸ´                         â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 10.2 Durant la tirada
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â† Cancel              TIRANT LES CARTES...                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚                        Cruz Celta                              â”‚
â”‚                                                                â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”                                    â”‚
â”‚                    â”‚ ğŸ‚   â”‚   â† Animant                        â”‚
â”‚                    â”‚     â”‚                                    â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”        â”Œâ”€â”€â”€â”              â”‚
â”‚         â”‚ ğŸ‚   â”‚   â”‚ ğŸ‚   â”‚   â”‚   â”‚        â”‚   â”‚              â”‚
â”‚         â”‚     â”‚   â”‚     â”‚   â”‚   â”‚        â”‚   â”‚              â”‚
â”‚         â””â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”˜        â””â”€â”€â”€â”˜              â”‚
â”‚                    â”Œâ”€â”€â”€â”                  â”Œâ”€â”€â”€â”              â”‚
â”‚                    â”‚   â”‚                  â”‚   â”‚              â”‚
â”‚                    â”‚   â”‚                  â”‚   â”‚              â”‚
â”‚                    â””â”€â”€â”€â”˜                  â””â”€â”€â”€â”˜              â”‚
â”‚                                                                â”‚
â”‚                    Tirant carta 4 de 10...                    â”‚
â”‚                    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 40%                     â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 10.3 RevelaciÃ³
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â† Tornar              REVELA LES CARTES                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚                        Cruz Celta                              â”‚
â”‚             Clica cada carta per revelar-la                    â”‚
â”‚                                                                â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”                                    â”‚
â”‚                    â”‚ ğŸ‚   â”‚   â† Pot clicar                     â”‚
â”‚                    â”‚     â”‚                                    â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”            â”‚
â”‚         â”‚ ğŸ‚   â”‚   â”‚     â”‚   â”‚ ğŸ‚   â”‚      â”‚     â”‚            â”‚
â”‚         â”‚     â”‚   â”‚ The â”‚   â”‚     â”‚      â”‚     â”‚            â”‚
â”‚         â””â”€â”€â”€â”€â”€â”˜   â”‚Fool â”‚   â””â”€â”€â”€â”€â”€â”˜      â”‚Deathâ”‚            â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                     âœ“ Revelada             âœ“ Revelada         â”‚
â”‚                                                                â”‚
â”‚                    ğŸ’¡ 2 de 10 revelades                       â”‚
â”‚                                                                â”‚
â”‚                                                                â”‚
â”‚              [REVELAR TOTES] [INTERPRETAR] ğŸ”®                 â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 11. Testing

### 11.1 Tests unitaris
```dart
// test/services/spread_selector_test.dart
group('SpreadSelector', () {
  test('selects Three Card spread for simple questions', () {
    final question = "Quin Ã©s el meu futur?";
    final spread = SpreadSelector.selectSpread(question);
    expect(spread.id, 'three_card');
  });

  test('selects Celtic Cross for complex questions', () {
    final question = "Com afectarÃ  la meva decisiÃ³ de canviar de feina...";
    final spread = SpreadSelector.selectSpread(question);
    expect(spread.id, 'celtic_cross');
  });

  test('selects Love spread when love keywords present', () {
    final question = "QuÃ¨ passa amb la meva relaciÃ³?";
    final spread = SpreadSelector.selectSpread(question);
    expect(spread.id, 'love_spread');
  });
});
```

### 11.2 Tests d'integraciÃ³
- Flux complet des de pregunta fins interpretaciÃ³
- PersistÃ¨ncia correcta de tirades
- Animacions no bloquegen UI
- GestiÃ³ correcta d'errors (network, etc.)

### 11.3 Tests d'usuari
- **Claredat**: Els usuaris entenen la pre-visualitzaciÃ³?
- **Engagement**: Les animacions milloren l'experiÃ¨ncia?
- **Temps**: El procÃ©s Ã©s massa llarg o adequat?
- **EducaciÃ³**: Els usuaris aprenen sobre les tirades?

---

## 12. MÃ¨triques de Ãˆxit

### 12.1 MÃ¨triques tÃ¨cniques
- **Performance**: 60 FPS durant animacions
- **Load time**: < 2s fins mostrar pre-visualitzaciÃ³
- **Error rate**: < 1% en selecciÃ³ de tirades
- **Completion rate**: % usuaris que completen revelaciÃ³

### 12.2 MÃ¨triques d'usuari
- **Engagement**: Temps mitjÃ  a la pantalla de revelaciÃ³
- **Satisfaction**: Rating de la feature
- **Learning**: % usuaris que exploren diferents tirades
- **Retention**: Usuaris que tornen desprÃ©s d'usar la feature

### 12.3 MÃ¨triques de negoci
- **Adoption**: % sessions que usen pre-visualitzaciÃ³
- **Premium conversion**: Impacte en subscripcions
- **Session length**: Augment de temps a l'app
- **Viral coefficient**: Usuaris que comparteixen tirades

---

## 13. Riscos i Mitigacions

### Risc 1: Animacions amb baixa performance
**Impacte**: Alta | **Probabilitat**: Mitja
**MitigaciÃ³**:
- Usar `RepaintBoundary` per aislar animacions
- Testejar en dispositius low-end
- OpciÃ³ per desactivar animacions

### Risc 2: IA tria tirada incorrecta
**Impacte**: Mitja | **Probabilitat**: Mitja
**MitigaciÃ³**:
- Sistema de feedback d'usuaris
- BotÃ³ "Triar una altra tirada"
- Millorar prompt amb iteracions

### Risc 3: Complexitat confon usuaris
**Impacte**: Alta | **Probabilitat**: Baixa
**MitigaciÃ³**:
- Onboarding clar amb tutorial
- OpciÃ³ de "mode simple" (directe a tirada)
- Tooltips contextuals

### Risc 4: Temps de cÃ rrega llarg
**Impacte**: Alta | **Probabilitat**: Baixa
**MitigaciÃ³**:
- Precarregar assets
- Caching agressiu
- Loading states clars

---

## 14. Roadmap Futur (Post-MVP)

### Fase 2 (3-6 mesos)
- **MÃ©s tirades**: Afegir 5-10 tirades addicionals
- **Tirades personalitzades**: Usuaris poden crear les seves
- **Sharing**: Compartir tirada (sense interpretaciÃ³)
- **Sounds**: Efectes de so opcionals

### Fase 3 (6-12 mesos)
- **AR Mode**: Veure tirada en realitat augmentada
- **Collaborative readings**: Tirades amb mÃºltiples usuaris
- **ML-powered selection**: Millorar selecciÃ³ amb machine learning
- **Voice input**: Fer pregunta per veu

### Fase 4 (12+ mesos)
- **Live readings**: Sessions en directe amb tarotistes
- **Community spreads**: Usuaris comparteixen tirades
- **Gamification**: Badges per tirades completades
- **API**: Permetre integraciÃ³ de tercers

---

## 15. ConclusiÃ³

Aquesta feature transformarÃ  l'experiÃ¨ncia de tarot en l'app de forma significativa:

### Valor per l'usuari:
âœ… **Educatiu**: Aprenen sobre tirades i significats
âœ… **Personalitzat**: Cada pregunta rep la tirada adequada
âœ… **Immersiu**: ProcÃ©s progressiu crea anticipaciÃ³
âœ… **Professional**: Replica lectura real de tarot
âœ… **Memorable**: ExperiÃ¨ncia Ãºnica i compartible

### Valor per el negoci:
âœ… **DiferenciaciÃ³**: Cap competidor tÃ© aquesta feature
âœ… **Engagement**: Augmenta temps a l'app
âœ… **Retention**: ExperiÃ¨ncia mÃ©s rica â†’ mÃ©s retorn
âœ… **Premium**: Justifica subscripciÃ³ premium
âœ… **Viral**: Usuaris comparteixen experiÃ¨ncia

### Viabilitat tÃ¨cnica:
âœ… **Implementable**: Tecnologies provades (Flutter, GPT-4)
âœ… **Escalable**: Arquitectura permet crÃ©ixer
âœ… **Maintainable**: Codi modular i ben estructurat
âœ… **Performant**: Animacions optimitzables

**RecomanaciÃ³**: IMPLEMENTAR per fases segons el pla detallat.

---

**Data**: 17 d'octubre de 2025
**Autor**: Informe tÃ¨cnic generat per anÃ lisi detallada
**VersiÃ³**: 1.0
**Status**: Proposat per implementaciÃ³
