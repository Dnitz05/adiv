{
  "paths": {
    "/api/simple-health": {
      "get": {
        "tags": ["Health"],
        "summary": "Simple health check",
        "responses": {
          "200": { "description": "OK", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/SimpleHealthResponse" } } } },
          "405": { "description": "Method not allowed" }
        }
      }
    },
    "/api/metrics": {
      "get": {
        "tags": ["Health"],
        "summary": "Dev-only endpoint with per-endpoint summaries",
        "responses": {
          "200": { "description": "OK", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/MetricsSummaryResponse" } } } },
          "403": { "description": "Forbidden (production)" }
        }
      }
    },
    "/api/simple-tarot": {
      "post": {
        "tags": ["Draw"],
        "summary": "Simple tarot draw (first 10 cards)",
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/SimpleTarotRequest" } } } },
        "responses": {
          "200": { "description": "OK", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/SimpleTarotResponse" } } } },
          "405": { "description": "Method not allowed" }
        }
      }
    },
    "/api/tarot-enhanced": {
      "post": {
        "tags": ["Draw"],
        "summary": "Enhanced tarot draw with spread",
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/TarotEnhancedRequest" } } } },
        "responses": {
          "200": { "description": "OK", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/TarotEnhancedResponse" } } } },
          "400": { "description": "Invalid request" },
          "405": { "description": "Method not allowed" }
        }
      }
    },
    "/api/tarot-ai-enhanced": {
      "post": {
        "tags": ["Draw"],
        "summary": "Tarot draw + AI interpretation",
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/TarotAIEnhancedRequest" } } } },
        "responses": {
          "200": { "description": "OK", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/TarotAIEnhancedResponse" } } } },
          "400": { "description": "Invalid request" },
          "405": { "description": "Method not allowed" }
        }
      }
    },
    "/api/premium-tarot": {
      "post": {
        "tags": ["Draw"],
        "summary": "Premium tarot (limits, features, AI)",
        "requestBody": { "required": true, "content": { "application/json": { "schema": { "$ref": "#/components/schemas/PremiumTarotRequest" } } } },
        "responses": {
          "200": { "description": "OK", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/PremiumTarotResponse" } } } },
          "400": { "description": "Invalid request" },
          "402": { "description": "Payment required / plan limits" },
          "405": { "description": "Method not allowed" }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "SimpleTarotRequest": {
        "type": "object",
        "properties": { "count": { "type": "integer", "default": 1 } },
        "required": ["count"]
      },
      "SimpleTarotCard": {
        "type": "object",
        "properties": {
          "id": { "type": "integer" },
          "name": { "type": "string" },
          "suit": { "type": "string" },
          "isReversed": { "type": "boolean" },
          "position": { "type": "integer" }
        }
      },
      "SimpleTarotResponse": {
        "type": "object",
        "properties": {
          "success": { "type": "boolean" },
          "data": { "type": "array", "items": { "$ref": "#/components/schemas/SimpleTarotCard" } },
          "meta": { "type": "object", "properties": { "count": { "type": "integer" }, "seed": { "type": "string" }, "method": { "type": "string" } } }
        },
        "required": ["success"]
      },
      "TarotEnhancedRequest": {
        "type": "object",
        "properties": {
          "count": { "type": "integer", "minimum": 1, "maximum": 10 },
          "allowReversed": { "type": "boolean", "default": true },
          "spread": { "type": "string" },
          "technique": { "type": "string", "enum": ["tarot"], "default": "tarot" }
        },
        "required": ["count"]
      },
      "TarotEnhancedResponse": {
        "type": "object",
        "properties": {
          "success": { "type": "boolean" },
          "data": { "type": "object", "properties": { "cards": { "type": "array", "items": { "$ref": "#/components/schemas/TarotCard" } }, "spread": { "type": "string" }, "spreadName": { "type": "string" } } },
          "meta": { "$ref": "#/components/schemas/ResponseMetadata" },
          "seed": { "type": "string" },
          "method": { "type": "string" },
          "signature": { "type": "string" },
          "orientationSeed": { "type": "string" },
          "orientationMethod": { "type": "string" },
          "independentOrientations": { "type": "boolean" }
        },
        "required": ["success"]
      },
      "TarotAIEnhancedRequest": {
        "type": "object",
        "properties": {
          "count": { "type": "integer", "minimum": 1, "maximum": 10 },
          "allowReversed": { "type": "boolean", "default": true },
          "spread": { "type": "string" },
          "question": { "type": "string" },
          "technique": { "type": "string", "enum": ["tarot"], "default": "tarot" },
          "includeAI": { "type": "boolean", "default": true }
        },
        "required": ["count"]
      },
      "TarotAIEnhancedResponse": {
        "type": "object",
        "properties": {
          "success": { "type": "boolean" },
          "data": {
            "type": "object",
            "properties": {
              "cards": { "type": "array", "items": { "$ref": "#/components/schemas/TarotCard" } },
              "spread": { "type": "object", "properties": { "id": { "type": "string" }, "name": { "type": "string" }, "description": { "type": "string" }, "count": { "type": "integer" } } },
              "interpretation": { "type": "object", "nullable": true }
            }
          },
          "meta": { "$ref": "#/components/schemas/ResponseMetadata" },
          "randomness": { "type": "object", "properties": { "seed": { "type": "string" }, "method": { "type": "string" }, "signature": { "type": "string" }, "orientationSeed": { "type": "string" }, "independentOrientations": { "type": "boolean" } } }
        },
        "required": ["success"]
      },
      "PremiumTarotRequest": {
        "type": "object",
        "properties": {
          "count": { "type": "integer" },
          "allowReversed": { "type": "boolean" },
          "spread": { "type": "string" },
          "question": { "type": "string" },
          "includeAI": { "type": "boolean" },
          "userId": { "type": "string" },
          "userTier": { "type": "string", "enum": ["free", "premium", "premium_annual"], "default": "free" }
        },
        "required": ["count", "userId"]
      },
      "PremiumTarotResponse": {
        "type": "object",
        "properties": {
          "success": { "type": "boolean" },
          "data": {
            "type": "object",
            "properties": {
              "cards": { "type": "array", "items": { "$ref": "#/components/schemas/TarotCard" } },
              "spread": { "type": "object", "properties": { "id": { "type": "string" }, "name": { "type": "string" }, "count": { "type": "integer" }, "isPremium": { "type": "boolean" } } },
              "interpretation": { "type": "object", "nullable": true }
            }
          },
          "premium": { "type": "object", "properties": { "tier": { "type": "string" }, "features": { "type": "object" }, "remainingReadings": { "type": "integer" }, "dailyLimit": { "type": "integer" }, "resetTime": { "type": "string" } } },
          "meta": { "type": "object", "properties": { "processingTimeMs": { "type": "number" }, "timestamp": { "type": "string" }, "version": { "type": "string" }, "technique": { "type": "string" }, "ai_model": { "type": ["string", "null"] } } },
          "randomness": { "type": "object", "properties": { "seed": { "type": "string" }, "method": { "type": "string" }, "signature": { "type": "string" }, "orientationSeed": { "type": ["string", "null"] }, "independentOrientations": { "type": "boolean" } } }
        },
        "required": ["success"]
      },
      "SimpleHealthResponse": {
        "type": "object",
        "properties": {
          "status": { "type": "string" },
          "timestamp": { "type": "string" },
          "message": { "type": "string" },
          "environment": { "type": "object" }
        }
      },
      "MetricsSummaryResponse": {
        "type": "object",
        "properties": {
          "success": { "type": "boolean" },
          "data": {
            "type": "object",
            "properties": {
              "endpoints": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "endpoint": { "type": "string" },
                    "p50": { "type": "number" },
                    "p95": { "type": "number" },
                    "avg": { "type": "number" },
                    "errorRate": { "type": "number" },
                    "rps": { "type": "number" },
                    "count": { "type": "integer" }
                  }
                }
              }
            }
          },
          "meta": { "type": "object", "properties": { "generatedAt": { "type": "string" } } }
        }
      }
    }
  }
}
