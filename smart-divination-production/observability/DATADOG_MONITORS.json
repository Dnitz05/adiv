[
  {
    "name": "API – Avg Latency > 800ms (5m) by endpoint",
    "type": "metric alert",
    "query": "avg(last_5m):avg:smart_divination.api.latency_ms{*} by {endpoint} > 800",
    "message": "@pagerduty High latency detected for {{endpoint.name}} (avg > 800ms over 5m)",
    "options": {
      "thresholds": { "critical": 800 },
      "notify_audit": false,
      "include_tags": true,
      "require_full_window": true
    },
    "tags": ["service:smart-divination", "team:backend"]
  },
  {
    "name": "API – 5xx rate > 1% (5m) by endpoint",
    "type": "query alert",
    "query": "avg(last_5m):100 * (sum:smart_divination.api.requests{status_group:5xx}.rollup(sum,300) by {endpoint}) / (sum:smart_divination.api.requests{*}.rollup(sum,300) by {endpoint}) > 1",
    "message": "@pagerduty Error rate > 1% for {{endpoint.name}} (5m)",
    "options": {
      "thresholds": { "critical": 1 },
      "notify_audit": false,
      "include_tags": true,
      "require_full_window": true
    },
    "tags": ["service:smart-divination", "team:backend"]
  }
]

